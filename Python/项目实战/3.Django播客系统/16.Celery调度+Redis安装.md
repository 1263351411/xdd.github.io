# Celery调度+Redis安装

Celery是一个使用Python开发的**分布式任务调度模块**，因此对于大量使用Python构建的系统,使用起来方便。  
Celery目前爸爸4.x,仅支持Django 1.8以上版本。 Celery 3.1只可以支持Django1.8一下版本。  

* Celery官网[http://www.celeryproject.org/](http://www.celeryproject.org/)  
* Celery帮助文档[http://www.celeryproject.org/docs-and-support/](http://www.celeryproject.org/docs-and-support/)

* 优点：
    1. 简单：调用接口简单易用
    2. 高可用：客户端、Worker之间连接自动重试，Broker自身支持HA
    3. 快速：单个Celery进程每分钟可用数以百万计的任务
    4. 灵活：Celery的每一个部分都能扩展，或直接使用，或用户自己定义。

## 常用应用

* Celery可用支持实时异步任务处理，也支持任务的定时调度。
    1. 异步发邮件
        * cleery执行队列
    2. 间隔半小时同步天气信息等
        * celery定时操作

## 角色

* 任务Task:对应一个Python函数
* 队列Queue:待执行任务的队列
* 工人Worker:一个新的进程，负者执行任务
* 代理Broker:负者调度，在任务环境中使用RabbitMQ、Redis等  

1. Celery需要依靠RabbitMQ等作为消息代理，同时也支持Redis甚至是Mysql、Mongo等，当然，官方默认推荐的是RabbitMQ,如果使用Redis需要配置。  
2. 本次采用Redis来作为Broker，也是Redis存储任务结果

## 安装

````shell
$ pip install celery==4.2.0

安装对redis的支持，并自动升级相关依赖
$ pip install -U "celery[redis]"
````

## 测试

Celery库使用前，必须初始化，所得示例叫做"应用application或app"。应用是线程安全的。不同应用在同一进程中，可以使用不同拍照、不同组件、不同结果

````python
from celery import Celery
app = Celery('mytask')
print(app)

@app.task
def add(x,y):
    return x+y

print(add.name) #mytask.add
print(add)

print(app.tasks)
print(app.conf)
print(*list(app.conf.items()),sep = '\n')
````

* 默认使用amqp链接到本地amqp://guest:**@localhost:5672//
* 本次使用Redis

### Redis安装配置 


