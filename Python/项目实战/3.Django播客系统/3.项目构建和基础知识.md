# 项目构建和基础知识--Django播客系统(三)

@[toc]

## 概述

* Django采用MVC架构设计的开源的WEB快速开发框架。
* 优点：
    1. 能够快速开发，自带ORM、Template、Form、Auth核心组件
    2. MVC设计模式
    3. 实用的管理后台Admin
    4. 简洁的url设计
    5. 周边插件丰富
* 缺点：架构重、同步阻塞
* 所有Django的设计目标就是一款大而全，便于企业快速开发项目的框架，因此企业应用较广。

## 安装Django

* Python实用3.6.x
* Django的下载地址[https://www.djangoproject.com/download/](https://www.djangoproject.com/download/)
* Python版本依赖，参看[https://docs.djangoproject.com/en/1.11/faq/install/#faq-python-version-support](https://docs.djangoproject.com/en/1.11/faq/install/#faq-python-version-support)

|Django version|Python版本|
|:-----------|:---------------|
|1.8|2.7,3.2 (until the end of 2016), 3.3, 3.4, 3.5|
|1.9,1.10|2.7,3.4,3.5|
|1.11(LTS)|2.7,3.4,3.5,3.6,3.7(added in 1.11.17)
|2.0|3.4,3.5,3.6,3.7|
|2.1,2.2(LTS)|3.5,3.6,3.7|

* 目前Django长期支持版本有1.11和2.2，这是企业的选择。
    1. `$ pip install django==2.2`
* 本次使用Django2.2版本，它也是长期支持版本LTS,请在虚拟环境中安装。
* 在虚拟环境路径中，`Lib/site-packeges/django/bin`下游一个django-admin.py,一起从它开始。

````cmd
# django-admin --version #查看当前django版本
# django-admin --help #查看使用帮助
# django-admin startproject --help #查看startproject命令帮助
````

````cmd
(venv) D:\MyPythonUse\DjangoWeb>django-admin

Type 'django-admin help <subcommand>' for help on a specific subcommand.

Available subcommands:

[django]
    check
    compilemessages
    createcachetable
    dbshell
    diffsettings
    dumpdata
    flush
    inspectdb
    loaddata
    makemessages
    makemigrations
    migrate
    runserver
    sendtestemail
    shell
    showmigrations
    sqlflush
    sqlmigrate
    sqlsequencereset
    squashmigrations
    startapp
    startproject
    test
    testserver
````

* 注意：**本文若未特殊声明，所有的命令操作都在项目的根目录下**

## 创建Django项目

* 创建名为blog的django项目`django-admin startproject djweb .`

* 上句命令就在当前项目根目录中构建了Django项目的初始文件。`.`点代表项目根目录。

````text
F:\CLASSES\TPROJECTS\BLOG10 
├─ manage.py
 └─ djweb
     ├─  settings.py
     ├─  urls.py
     ├─  wsgi.py
     └─  __init__.py
````

* 重要文件说明
    1. manage.py:本项目管理的命令行工具。应用创建、数据库迁移等都使用它完成
    2. dgweb/settings.py：本项目的核心配置文件。数据库、中间件、模板等
    3. dgweb/urls.py:URL路径映射配置。项目初始，只配置了/admin的路由。
    4. dgweb/wsgi:定义WSGI接口信息。部署用，一般无需改动。

### 数据库配置

使用数据库，需要修改默认的数据库配置。  
在主项目的settings.py下DATABASES。默认使用的sqlite，修改为mysql。  

````py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'gdy',
        'USER': 'gdy',
        'PASSWORD': 'gdy',
        'HOST': '127.0.0.1',
        'PORT': '3306',
    }
}
````

|配置项|说明|
|:-----|:----|
|HOST|数据库主机。缺省是空字符串，代表localhost。如果是`/`开头表示使用UnixSocket链接|
|POST|端口|
|USER|用户名|
|PASSWORD|密码|
|NAME|库名|
|OPTIONS|选项、字典类型，参考MySQL文档|

1. 数据库引擎ENGINE
2. 内建引擎有
    * `django.db.backends.postgresql`
    * `django.db.backends.mysql`
    * `django.db.backends.sqlite3`
    * `django.db.backends.oracle`

### MySQL数据库驱动

[https://docs.djangoproject.com/en/1.11/ref/databases/#mysql-db-api-drivers](https://docs.djangoproject.com/en/1.11/ref/databases/#mysql-db-api-drivers)  

Django支持MySQL5.5+  
Django官方推荐使用本地驱动mysqlclient 1.3.7+

* 安装mysql驱动`pip install mysqlclient`

````txt
windows下可能发生安装错误 error: Microsoft Visual C++ 14.0 is required.解决方法  
1、下载Visual C++ Redistributable Packages 2015、2017安装，但是即使安装后，确实看到了V14库，也不保证 安装mysqlclient就成功  
2、直接安装编译好的wheel文件  
mysqlclient-1.3.13-cp35-cp35m-win_amd64.whl ，python 3.5使用  
mysqlclient-1.3.13-cp36-cp36m-win_amd64.whl ，python 3.6使用  
mysqlclient-1.4.2-cp37-cp37m-win_amd64.whl，  python 3.7使用  

$ pip install mysqlclient-1.3.13-cp35-cp35m-win_amd64.whl 
参考 https://stackoverflow.com/questions/29846087/microsoft-visual-c-14-0-is-required-unable-tofind-vcvarsall-bat

下载地址 https://www.lfd.uci.edu/~gohlke/pythonlibs/
--------------------------------------------------------------------------------
Linux、Mac请参照官网安装依赖库  
https://pypi.org/project/mysqlclient/
````

### 创建应用

* 创建用户应用`python manage.py startapp user`。创建应用后，项目根目录下产生一个user目录，有如下文件：
    1. `admin.py`:应用后台管理声明文件
    2. `models.py`:模型层Model类定义
    3. `views.py`:定义URL响应函数或类
    4. `migrations包`：数据迁移文件生成目录
    5. `apps.py`：应用的信息定义文件

    ![django3_001](../../../img/python/django3_001.jpg)

    1. user应用创建后应该完成以下功能：
        1. 用户注册
        2. 用户登录

### 注册应用

在`settings.py`中，增加user应用。目的是为了**后台管理**admin使用，或**迁移**migrate使用

````python
#settings.py文件中
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'user'
]
````

### 模型Model

* **字段类型**

|字段类|说明|
|:-----|:----|
|AutoField|自增的整数字段。<br/>如果不指定，django会为模型类自动增加主键字段|
|BooleanField|布尔值字段，True和False <br/>对应表单控件CheckboxInput|
|NullBooleanField|比BooleanField多一个null值|
|CharField|字符串，max_length设定字符长度 <br/>对应表单控件TextInput|
|TextField|大文本字段，一般超过4000个字符串使用<br/>对应表单控件Textarea|
|IntegerField|整数字段|
|BigIntegerField|更大整数字段，8字节|
|DecimalField|使用Python的Decimal实例表示十进制浮点数。max_digits总位数。<br/>decimal_piaces小数点后的位数|
|FloatField|Python的Float实例表示的浮点数|
|DateFleld|使用Python的datetime.date实例表示的日期<br/>auto_now=False每次修改对象自动设置为当前时间。auto_now_add=False对象第一次创建时自动设置为当前时间。auto_now_add、auto_now、default互斥对应控件为TextInput,关联了一个js编写的日历控件|




























